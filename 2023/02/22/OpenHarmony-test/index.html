<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> OpenHarmony测试指南 · VictorV的小博客</title><meta name="description" content="OpenHarmony测试指南 - VictorV"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://474172261.github.io/atom.xml" title="VictorV的小博客"><meta name="generator" content="Hexo 6.2.0"><link rel="alternate" href="/atom.xml" title="VictorV的小博客" type="application/atom+xml">
</head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/images/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://twitter.com/vv474172261" target="_blank" class="nav-list-link">TWITTER</a></li><li class="nav-list-item"><a href="https://github.com/474172261" target="_blank" class="nav-list-link">GITHUB</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">OpenHarmony测试指南</h1><div class="post-info">2023年2月22日</div><div class="post-content"><p>官方虽然有不少资料, 但是都很分散, 我整理一下关于rk3568的测试资料, 方便大家参考.</p>
<span id="more"></span>


<h1 id="系统编译"><a href="#系统编译" class="headerlink" title="系统编译"></a>系统编译</h1><ol>
<li><p>参照<a target="_blank" rel="noopener" href="https://device.harmonyos.com/cn/docs/documentation/guide/ide-install-windows-ubuntu-0000001194073744">搭建开发环境</a> 准备好Ubuntu环境和windows的vscode环境, 完成remote-ssh连接.</p>
</li>
<li><p>准备好源码, 参考<a target="_blank" rel="noopener" href="https://device.harmonyos.com/cn/docs/documentation/guide/create_project-0000001072200151">创建OpenHarmony工程</a>章节, 自动获取源码, 或者导入自己存在的源码.</p>
<blockquote>
<p>可以从<a target="_blank" rel="noopener" href="https://repo.huaweicloud.com/harmonyos/os/">此处获取源码</a></p>
</blockquote>
</li>
<li><p>对于rk3568设备, 参考<a target="_blank" rel="noopener" href="https://device.harmonyos.com/cn/docs/documentation/guide/ide-rk3568-compile-0000001238957517">编译RK3568开发板源码</a>章节的<strong>1</strong>,<strong>2</strong>,<strong>3</strong>的内容. 准备好后, 参考<a target="_blank" rel="noopener" href="https://gitee.com/hihope_iot/docs/blob/master/HiHope_DAYU200/%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%E7%BC%96%E8%AF%91%E6%8C%87%E5%8D%97.md">HiHope_DAYU200&#x2F;开发环境搭建编译指南</a>, 安装需要的组件, 如下:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install binutils git git-lfs gnupg flex</span><br><span class="line">bison gperf build-essential zip curl zlib1g-dev gcc-multilib g++-multilib</span><br><span class="line">libc6-dev-i386 lib32ncurses5-dev x11proto-core-dev libx11-dev lib32z1-dev ccache</span><br><span class="line">libgl1-mesa-dev libxml2-utils xsltproc unzip m4 bc gnutls-bin python3.8</span><br><span class="line">python3-pip ruby libtinfo-dev libtinfo5</span><br></pre></td></tr></table></figure>

<blockquote>
<p>如果安装有问题, 可以考虑使用aptitude来解决.</p>
</blockquote>
</li>
<li><p>最后可以执行<code>./build.sh --product-name rk3568 --target-cpu arm64 --ccache</code>编译64位系统.</p>
</li>
</ol>
<p><strong>如果不想编译, 可以访问<a target="_blank" rel="noopener" href="https://ci.openharmony.cn/workbench/cicd/dailybuild/detail/component">openharmony 数字化协作平台</a>, 选择”CICD-每日构建” 找到想要的版本的编译后文件.</strong></p>
<p><img src="/images/OpenHarmony-test/1732781270513.png" alt="1732781270513"></p>
<p>如果烧录后不能正常启动, 就换一个版本, 省时间.</p>
<h1 id="rk3568系统烧录"><a href="#rk3568系统烧录" class="headerlink" title="rk3568系统烧录"></a>rk3568系统烧录</h1><p>参考<a target="_blank" rel="noopener" href="https://gitee.com/hihope_iot/docs/blob/master/HiHope_DAYU200/docs/%E7%83%A7%E5%BD%95%E6%8C%87%E5%AF%BC%E6%96%87%E6%A1%A3.md"> 烧录指导文档</a></p>
<ol>
<li><p>按照如图所示连接电源线, 串口线, usb线</p>
<p><img src="/images/OpenHarmony-test/image-20220516164155093-1670578318853.png" alt="image-20220516164155093"> </p>
</li>
<li><p>下载<a target="_blank" rel="noopener" href="https://gitee.com/hihope_iot/docs/tree/master/HiHope_DAYU200/%E7%83%A7%E5%86%99%E5%B7%A5%E5%85%B7%E5%8F%8A%E6%8C%87%E5%8D%97/windows">驱动工具</a></p>
<blockquote>
<p>需要下载的文件:  DriverAssitant_v5.1.1.zip,  RKDevTool.exe,  config.ini, Language 目录.</p>
<p>一定要保留Language目录, 否则工具会出现点一下就崩溃或者一直static的状况.</p>
</blockquote>
<p>解压DriverAssitant_v5.1.1.zip后, 运行<code>DriverAssitant\DriverInstall.exe  </code>, 点击<code>驱动安装</code>.</p>
</li>
<li><p>打开<code>RKDevTool.exe </code>烧写工具, 查看设备状态.</p>
<p>如果开着机, 默认是如下状态:</p>
<p><img src="/images/OpenHarmony-test/1672023200456.png" alt="1672023200456"></p>
</li>
<li><p>按住下图所示两个键</p>
<p><img src="/images/OpenHarmony-test/image-20220516170351601.png" alt="image-20220516170351601"> </p>
<p>烧录工具会提示没发现设备.</p>
<p>然后松开reset键, 显示”发现一个loader设备”. 然后松开剩下的按键. 等待3秒.</p>
</li>
</ol>
<h2 id="使用烧录工具烧录"><a href="#使用烧录工具烧录" class="headerlink" title="使用烧录工具烧录"></a>使用烧录工具烧录</h2><p>vscode烧录时, 传输文件会比scp命令慢, 我们可以手动烧录.</p>
<p>将ubuntu目录源码的<code>out/rk3568/packages/phone/images/</code>目录下的所有文件拷贝到本地, 然后在<code>RKDevTool.exe </code>工具的栏目里右键选择<code>load config</code>, 加载目录里的<code>config.cfg</code>文件, 并修改好每个文件的路径. 点击<code>执行</code>烧录.</p>
<h2 id="使用vscode工具烧录"><a href="#使用vscode工具烧录" class="headerlink" title="使用vscode工具烧录"></a>使用vscode工具烧录</h2><ol>
<li><p>确保机器连接成功</p>
<p>在DevEco Device Tool中，选择<strong>REMOTE DEVELOPMENT &gt; Local PC</strong>，查看远程计算机（Ubuntu开发环境）与本地计算机（Windows开发环境）的连接状态。</p>
<ul>
<li>如果Local PC右边连接按钮为<img src="/images/OpenHarmony-test/0000000000011111111.20220617164602.73645117545890562218658911880196.png" alt="img">则远程计算机与本地计算机为已连接状态，不需要执行其他操作。</li>
<li>如果Local PC右边连接按钮为<img src="/images/OpenHarmony-test/0000000000011111111.20220617164602.26357696204473864583858211392894.png" alt="img">则点击绿色按钮进行连接。连接时DevEco Device Tool会重启服务，因此请不要在下载源码或源码编译过程中进行连接，否则会中断任务</li>
</ul>
</li>
<li><p>在vs code中点击upload选项即可烧录.<img src="/images/OpenHarmony-test/0000000000011111111.20221103203816.15089950501154467365030783854423.png" alt="img"> </p>
</li>
<li><p>vscode会先拷贝文件到本地, 拷贝完成后, 会提示按键开始烧录</p>
</li>
</ol>
<h1 id="实用命令"><a href="#实用命令" class="headerlink" title="实用命令"></a>实用命令</h1><p><code>hdc shell power-shell setmode 602</code> 屏幕常量</p>
<p><code>/vendor/bin/wpa_supplicant -i wlan0 -c /data/my_wpa_supplicant.conf -B</code> 手动配置wifi</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">network=&#123;</span><br><span class="line">ssid=&quot;wifiname&quot;</span><br><span class="line">psk=&quot;wifipassword&quot;</span><br><span class="line">priority=2</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="创建应用调试"><a href="#创建应用调试" class="headerlink" title="创建应用调试"></a>创建应用调试</h1><ol>
<li><p>下载安装<a target="_blank" rel="noopener" href="https://developer.harmonyos.com/cn/develop/deveco-studio#download">HUAWEI DevEco Studio </a></p>
</li>
<li><p>启动它, 一步步继续就行, 然后会强制安装<code>Harmony SDK</code>, 继续</p>
</li>
<li><p>创建OpenHarmony 应用</p>
<p><img src="/images/OpenHarmony-test/1670580451653.png" alt="1670580451653"></p>
</li>
<li><p>接着会提示你安装<code>OpenHarmony SDK</code>, 安装即可</p>
<p><img src="/images/OpenHarmony-test/1670580505134.png" alt="1670580505134"></p>
</li>
<li><p>项目就创建完成了, 如果设备连接正常, 此处会有显示</p>
<p><img src="/images/OpenHarmony-test/1670580590649.png" alt="1670580590649"></p>
</li>
<li><p>选择<code>File-&gt;Project Structure</code>, 按下图所示</p>
<p><img src="/images/OpenHarmony-test/1670580692357.png" alt="1670580692357"></p>
<p>先择自动签名.</p>
</li>
<li><p>完成后就可以在下图位置开始调试和测试运行了</p>
<p><img src="/images/OpenHarmony-test/1670580744213.png" alt="1670580744213"></p>
</li>
</ol>
<p>参考: <a target="_blank" rel="noopener" href="https://developer.harmonyos.com/cn/docs/documentation/doc-guides/installation_process-0000001071425528">DevEco Studio 搭建</a></p>
<h2 id="设置应用权限"><a href="#设置应用权限" class="headerlink" title="设置应用权限"></a>设置应用权限</h2><p>应用一般有3个等级:</p>
<table>
<thead>
<tr>
<th>APL级别</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>system_core等级</td>
<td>该等级的应用服务提供操作系统核心能力。</td>
</tr>
<tr>
<td>system_basic等级</td>
<td>该等级的应用服务提供系统基础服务。</td>
</tr>
<tr>
<td>normal等级</td>
<td>普通应用。</td>
</tr>
</tbody></table>
<p>可以查看此处的<a target="_blank" rel="noopener" href="https://developer.harmonyos.com/cn/docs/documentation/doc-guides-V3/permission-list-0000001478341001-V3">权限列表</a>来确认模块所需的权限. (华为的人老是乱改链接, 如果失效了, 就<a target="_blank" rel="noopener" href="https://developer.harmonyos.com/cn/docs/search?val=%E5%BA%94%E7%94%A8%E6%9D%83%E9%99%90%E5%88%97%E8%A1%A8">搜索</a>)</p>
<p>如果我们需要一个高一点的权限, 比如说 system_basic, 那么就需要额外的操作设置一下. 下面示例设置<strong>ohos.permission.DISTRIBUTED_SOFTBUS_CENTER</strong> 权限</p>
<ol>
<li><p>创建一个空的Openharmony项目, 在项目的 <code>entry/src/main</code>下, 找到 <code>module.json5</code> 文件</p>
<p><img src="/images/OpenHarmony-test/1675148476629.png" alt="1675148476629"></p>
</li>
<li><p>在文件的 module 的大括号内添加如下权限请求:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;  </span><br><span class="line">  &quot;module&quot;: &#123;</span><br><span class="line">    xxx: [</span><br><span class="line">    ...</span><br><span class="line">    ],</span><br><span class="line">    &quot;requestPermissions&quot;: [// 新增此项</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;name&quot;: &quot;ohos.permission.DISTRIBUTED_SOFTBUS_CENTER&quot;// 需要的权限</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>更多设置<a target="_blank" rel="noopener" href="https://bbs.elecfans.com/jishu_2313453_1_1.html">参考</a></p>
</li>
<li><p>找到 <strong>UnsgnedReleasedProfileTemplate.json</strong> 文件, 默认在<code>C:\Users\vv\AppData\Local\OpenHarmony\Sdk\9\toolchains\lib\UnsgnedReleasedProfileTemplate.json</code>, 修改其中的内容:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&quot;apl&quot;:&quot;system_basic&quot;,// 根据权限列表的内容, DISTRIBUTED_SOFTBUS_CENTER 需要 system_basic权限</span><br><span class="line">&quot;app-feature&quot;:&quot;hos_system_app&quot; // 系统基础服务app</span><br></pre></td></tr></table></figure>

<p>更多设置<a target="_blank" rel="noopener" href="https://www.51cto.com/article/741793.html">参考</a></p>
</li>
<li><p>然后找到默认的签名证书, <code>C:\Users\vv\.ohos\config\openharmony</code>, 把目录下以<code>auto_ohos_default_你的项目名称...</code>开头的文件都删除. 同时清理项目的<code>build-profile.json5</code>的<strong>signingConfigs</strong>的内容为 <code>&quot;signingConfigs&quot;:[],</code></p>
</li>
<li><p>在DevEco里,  <code>File -&gt; Project Structure-&gt;Project-&gt;Signing Configs</code>里设置自动签名.</p>
<p><img src="/images/OpenHarmony-test/1675149053919.png" alt="1675149053919"></p>
</li>
<li><p>最后编译好就可以直接安装测试了.</p>
</li>
</ol>
<h1 id="测试用例的生成"><a href="#测试用例的生成" class="headerlink" title="测试用例的生成"></a>测试用例的生成</h1><h2 id="使用DevEco生成测试用例"><a href="#使用DevEco生成测试用例" class="headerlink" title="使用DevEco生成测试用例"></a>使用DevEco生成测试用例</h2><p>这里需要感谢<strong>k0shl</strong>(<a target="_blank" rel="noopener" href="https://twitter.com/keyz3r0?lang=en">@KeyZ3r0</a>)大佬的帮助, 找到了ipc的直接调用方法:</p>
<p>文件<code>xxx.ets</code>里: </p>
<p>以下是4.x版本</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">import rpc from &#x27;@ohos.rpc&#x27;</span><br><span class="line"></span><br><span class="line">@Entry</span><br><span class="line">@Component</span><br><span class="line">struct Index &#123;</span><br><span class="line">  @State message: string = &#x27;ipc Test&#x27;</span><br><span class="line">  @State result: string = &#x27;type to start&#x27;</span><br><span class="line">  @State button: string = &#x27;Start&#x27;</span><br><span class="line"></span><br><span class="line">  build() &#123;</span><br><span class="line">    Row() &#123;</span><br><span class="line">      Column() &#123;</span><br><span class="line">        Text(this.message)</span><br><span class="line">          .fontSize(40)</span><br><span class="line">          .fontWeight(FontWeight.Bold)</span><br><span class="line"></span><br><span class="line">        Text(this.result)</span><br><span class="line">          .fontSize(20)</span><br><span class="line">          .fontColor(Color.Red)</span><br><span class="line">          .fontWeight(FontWeight.Bold)</span><br><span class="line"></span><br><span class="line">        Button(this.button)</span><br><span class="line">          .fontSize(40)</span><br><span class="line">          .fontWeight(FontWeight.Bold)</span><br><span class="line">          .onClick(() =&gt; &#123;</span><br><span class="line">            let proxy = rpc.IPCSkeleton.getContextObject();//初始化一个local register service的IRemoteObject</span><br><span class="line">            if (proxy == null) &#123;</span><br><span class="line">              this.result = &quot;connect error&quot;;</span><br><span class="line">              return</span><br><span class="line">            &#125;</span><br><span class="line">            let data = rpc.MessageParcel.create();</span><br><span class="line">            data.writeInterfaceToken(&quot;ohos.samgr.accessToken&quot;); //固定值，是samgr的interface token</span><br><span class="line">            data.writeInt(3503); //想往哪个service发IPC消息，设定这个值，一般这个值在对应服务的头文件里, 比如软总线就是 SOFTBUS_SERVER_SA_ID_INNER 4700</span><br><span class="line">            data.writeBoolean(false); //默认为false</span><br><span class="line">            let reply = rpc.MessageParcel.create();</span><br><span class="line">            let opt = new rpc.MessageOption();</span><br><span class="line">            proxy.sendRequestAsync(2, data, reply, opt) //首先发送CheckSystemAbility到samgr</span><br><span class="line">              .then(value =&gt; &#123;</span><br><span class="line">                if(value.errCode != 0)&#123;</span><br><span class="line">                  this.result = &quot;send request failed. errcode: &quot; + value.errCode</span><br><span class="line">                  return</span><br><span class="line">                &#125;</span><br><span class="line">                let atproxy = reply.readRemoteObject(); //若成功，返回的MessageParcel reply会包含目标服务的IRemoteObject</span><br><span class="line">                let atdata = rpc.MessageParcel.create();</span><br><span class="line">                let atreply = rpc.MessageParcel.create();</span><br><span class="line">                atdata.writeInterfaceToken(&quot;test&quot;); //构造目标服务想测试的interface的MessageParcel, 具体参考目标服务如何解析的数据</span><br><span class="line">                atdata.writeInt(0xdeadbeef);</span><br><span class="line">                atdata.writeString(&quot;test&quot;);</span><br><span class="line">                this.result = &quot;finish1&quot;</span><br><span class="line">                let atopt = new rpc.MessageOption();</span><br><span class="line">                atproxy.sendRequestAsync(0xff10, atdata, atreply, atopt).then(result =&gt; &#123; //发送测试数据给目标服务，SendRequest的第一个参数为目标服务的接口，</span><br><span class="line">                  //是一个enumerate，可以从目标服务目录的头文件里找到，</span><br><span class="line">                  //比如/home/user/Desktop/code-v3.2-Beta4/OpenHarmony/base/security/access_token/frameworks/accesstoken/include/i_accesstoken_manager.h</span><br><span class="line">                  //路径里的enum class InterfaceCode</span><br><span class="line">                  this.result = &quot;finish222&quot;</span><br><span class="line">                  if(result.errCode == 0)&#123;</span><br><span class="line">                    this.result = &quot;finish all&quot;</span><br><span class="line">                    return</span><br><span class="line">                  &#125;</span><br><span class="line">                &#125;)</span><br><span class="line">              &#125;).catch(function(e)&#123;</span><br><span class="line">              this.result = &quot;catch exception. error:&quot; + e;</span><br><span class="line">              return</span><br><span class="line">            &#125;);</span><br><span class="line">          &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">      .width(&#x27;100%&#x27;)</span><br><span class="line">    &#125;</span><br><span class="line">    .width(&#x27;100%&#x27;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>上述示例实现了一个 ipc 消息发送操作.</p>
<blockquote>
<p>截止 2023&#x2F;1&#x2F;31, Openharmony的sdk里, <code>MessageParcel</code>接口不支持writeCString. 如果需要写入字符串, 可以考虑用 <code>writeInt</code> 替代, 因为写入字符串也是4字节对齐的, 而CString的方式相当于写Int.</p>
</blockquote>
<p>5.x版本</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line">import &#123; Want, common &#125; from &#x27;@kit.AbilityKit&#x27;;</span><br><span class="line">import &#123; rpc &#125; from &#x27;@kit.IPCKit&#x27;;</span><br><span class="line">import &#123; hilog &#125; from &#x27;@kit.PerformanceAnalysisKit&#x27;;</span><br><span class="line"></span><br><span class="line">@Entry</span><br><span class="line">@Component</span><br><span class="line">struct Index &#123;</span><br><span class="line">  @State message: string = &#x27;PublishPNN Test&#x27;</span><br><span class="line">  @State result: string = &#x27;type to start&#x27;</span><br><span class="line">  @State button: string = &#x27;Start&#x27;</span><br><span class="line">  @State SOFTBUS_SERVER_SA_ID_INNER: number = 4700</span><br><span class="line"></span><br><span class="line">  build() &#123;</span><br><span class="line">    Row() &#123;</span><br><span class="line">      Column() &#123;</span><br><span class="line">        Text(this.message)</span><br><span class="line">          .fontSize(40)</span><br><span class="line">          .fontWeight(FontWeight.Bold)</span><br><span class="line"></span><br><span class="line">        Text(this.result)</span><br><span class="line">          .fontSize(20)</span><br><span class="line">          .fontColor(Color.Red)</span><br><span class="line">          .fontWeight(FontWeight.Bold)</span><br><span class="line"></span><br><span class="line">        Button(this.button)</span><br><span class="line">          .fontSize(40)</span><br><span class="line">          .fontWeight(FontWeight.Bold)</span><br><span class="line">          .onClick(() =&gt; &#123;</span><br><span class="line">            let proxy = rpc.IPCSkeleton.getContextObject();//初始化一个local register service的IRemoteObject</span><br><span class="line">            if (proxy == null) &#123;</span><br><span class="line">              this.result = &quot;connect error&quot;;</span><br><span class="line">              return</span><br><span class="line">            &#125;</span><br><span class="line">            let data = rpc.MessageSequence.create();</span><br><span class="line">            data.writeInterfaceToken(&quot;ohos.samgr.accessToken&quot;); //固定值，是samgr的interface token</span><br><span class="line">            data.writeInt(this.SOFTBUS_SERVER_SA_ID_INNER); //想往哪个service发IPC消息，设定这个值，一般这个值在对应服务的头文件里</span><br><span class="line">            data.writeBoolean(false); //默认为false</span><br><span class="line">            let reply = rpc.MessageSequence.create();</span><br><span class="line">            let opt = new rpc.MessageOption();</span><br><span class="line">            this.result = &quot;send getRemote data waiting...&quot;</span><br><span class="line">            proxy.sendMessageRequest(2, data, reply, opt) //首先发送CheckSystemAbility到samgr</span><br><span class="line">              .then(value =&gt; &#123;</span><br><span class="line">                this.result = &quot;send data finish&quot;</span><br><span class="line">                if (value.errCode != 0) &#123;</span><br><span class="line">                  this.result = &quot;send request failed. errcode: &quot; + value.errCode</span><br><span class="line">                  return</span><br><span class="line">                &#125;</span><br><span class="line">                let atproxy = reply.readRemoteObject(); //若成功，返回的MessageParcel reply会包含目标服务的IRemoteObject</span><br><span class="line">                let atdata = rpc.MessageSequence.create();</span><br><span class="line">                let atreply = rpc.MessageSequence.create();</span><br><span class="line">                let info = [0xcc, 0xcd, 0xce];</span><br><span class="line">                atdata.writeInterfaceToken(&quot;OHOS.ISoftBusServer&quot;); //构造目标服务想测试的interface的MessageParcel</span><br><span class="line">                atdata.writeByte(0x41); // pkgName</span><br><span class="line">                atdata.writeInt(4); // infoTypeLen</span><br><span class="line">                let atopt = new rpc.MessageOption();</span><br><span class="line">                this.result = &quot;send SERVER_PUBLISH_LNN data waiting...&quot;</span><br><span class="line">                atproxy.sendMessageRequest(155, atdata, atreply, atopt)</span><br><span class="line">                  .then((result: rpc.RequestResult) =&gt; &#123; // SERVER_PUBLISH_LNN</span><br><span class="line">                    this.result = &quot;send SERVER_PUBLISH_LNN data finish&quot;</span><br><span class="line">                    if (result.errCode == 0) &#123;</span><br><span class="line">                      this.result = &quot;finish all&quot;</span><br><span class="line">                      return</span><br><span class="line">                    &#125;</span><br><span class="line">                    this.result = &quot;send request failed. errcode: &quot; + result.errCode</span><br><span class="line">                  &#125;)</span><br><span class="line">                  .catch((e: Error) =&gt; &#123;</span><br><span class="line">                    hilog.error(0x0000, &#x27;testTag&#x27;, &#x27;sendMessageRequest got exception: &#x27; + e);</span><br><span class="line">                  &#125;)</span><br><span class="line">                  .finally(() =&gt; &#123;</span><br><span class="line">                    data.reclaim();</span><br><span class="line">                    reply.reclaim();</span><br><span class="line">                  &#125;)</span><br><span class="line">              &#125;)</span><br><span class="line">          &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">      .width(&#x27;100%&#x27;)</span><br><span class="line">    &#125;</span><br><span class="line">    .width(&#x27;100%&#x27;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="使用原始测试组件生成测试用例"><a href="#使用原始测试组件生成测试用例" class="headerlink" title="使用原始测试组件生成测试用例"></a>使用原始测试组件生成测试用例</h2><p>OpenHarmony自带google test, 如果要测试, 也可以通过修改自带的测试用例来实现我们的需求.</p>
<ol>
<li><p>在<code>OpenHarmony/foundation/communication/dsoftbus/tests/BUILD.gn</code>添加新的测试用例</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">features += [</span><br><span class="line">  &quot;sdk/discovery/unittest:DiscSdkTest&quot;,// 这个默认就有</span><br><span class="line">  &quot;sdk/transmission/trans_channel:TransSdkTest&quot;,</span><br><span class="line">  &quot;adapter/unittest:AdapterTest&quot;,</span><br><span class="line">  &quot;sdk/bus_center/unittest:BusCenterSdkTest&quot;,// 如果我添加这个, 后面生成的命令就需要换成 ./build.sh --product-name rk3568 --build-target BusCenterSdkTest</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>测试用例所在目录的<code>build.gn</code>的解读:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">bus_center_sdk_test_src = [ &quot;bus_center_sdk_test.cpp&quot; ]// 源码文件之一</span><br><span class="line">...</span><br><span class="line">  ohos_unittest(&quot;BusCenterSdkTest&quot;) &#123;// 添加用例的名称</span><br><span class="line">    module_out_path = module_output_path</span><br><span class="line">    sources = bus_center_sdk_test_src// 涉及到的源码文件</span><br><span class="line">    include_dirs = bus_center_sdk_test_inc</span><br><span class="line">    include_dirs += [</span><br><span class="line">      &quot;unittest/common/&quot;,</span><br><span class="line">      &quot;//utils/native/base/include&quot;,</span><br><span class="line">    ]</span><br><span class="line">    ...</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>


</li>
<li><p>使用<code>./build.sh --product-name rk3568 --build-target DiscSdkTest --target-cpu arm64 --ccache </code>生成测试用例</p>
<p>生成位置<code>OpenHarmony/out/rk3568/tests/unittest/dsoftbus/discovery/DiscSdkTest</code>(此版本是stripped的版本, 但是有函数名称, 如果没有, 说明IDA版本过低)</p>
<blockquote>
<p>为了方便调试, 可以在<code>OpenHarmony/out/rk3568/exe.unstripped/tests/unittest/dsoftbus/discovery/DiscSdkTest </code>位置找到<code>not stripped</code>的版本.</p>
</blockquote>
</li>
</ol>
<h1 id="调试器调试"><a href="#调试器调试" class="headerlink" title="调试器调试"></a>调试器调试</h1><h2 id="64位系统的调试"><a href="#64位系统的调试" class="headerlink" title="64位系统的调试"></a>64位系统的调试</h2><p>在<a target="_blank" rel="noopener" href="https://github.com/hugsy/gdb-static">gdb-static</a>下载gdbserver, 然后在ubuntu编译一个支持aarch64的gdb.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ apt-get install python-dev</span><br><span class="line">$ <span class="built_in">mkdir</span> build</span><br><span class="line">$ <span class="built_in">mkdir</span> out</span><br><span class="line">$ <span class="built_in">cd</span> build</span><br><span class="line">$ ../configure --build=x86_64-pc-linux-gnu -target=aarch64-linux-gnu --prefix=/home/vv/gdb-8.2.1/out --with-python</span><br><span class="line">$ make</span><br><span class="line">$ make install</span><br></pre></td></tr></table></figure>

<p>在机器上操作连接wifi网络, 使用gdbserver启动程序</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ./gdbserver-8.3.1-aarch64-le 192.168.1.4:1234 ./BusCenterSdkTest</span><br></pre></td></tr></table></figure>

<p>在Ubuntu使用编译的gdb连接程序:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ./aarch64-linux-gnu-gdb</span><br></pre></td></tr></table></figure>

<p>为了方便调试, 可以使用文末的gdb脚本.</p>
<h2 id="32位系统的调试-不建议-可以忽略此节"><a href="#32位系统的调试-不建议-可以忽略此节" class="headerlink" title="32位系统的调试(不建议, 可以忽略此节)"></a>32位系统的调试(不建议, 可以忽略此节)</h2><p>尝试过使用编译的gdb调试(参考<a target="_blank" rel="noopener" href="https://ost.51cto.com/posts/16933">编译gdb</a>), 但是rk3568的32位版本的内核实现有点问题, 会在某些syscall调用中失败. 因此建议使用lldb调试. OpenHarmony SDK会带lldb调试器, <code>C:\Users\xx\AppData\Local\OpenHarmony\Sdk\9\native\llvm\lib\clang\12.0.1\bin\arm-linux-ohos\lldb-server</code>(它也有64位的)</p>
<p><a href="/otherfile/lldb-server.7z">点击此处下载</a></p>
<ol>
<li><p>获取<code>hdc_std</code>工具, 可以<a target="_blank" rel="noopener" href="https://gitee.com/isrc_ohos/hdc-tool">网上下载</a>, 安装了SDK也会自带<code>C:\Users\vv\AppData\Local\OpenHarmony\Sdk\9\toolchains\hdc_std.exe</code>.</p>
</li>
<li><p>传递lldb</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&gt; .\hdc_std.exe list targets 查看设备</span><br><span class="line">7001005458323933328a268f9c7f3900</span><br><span class="line">&gt; .\hdc_std.exe file send D:\lldb-server /data 将本地文件传递到设备的/data目录</span><br><span class="line">FileTransfer finish, Size:xxx, File count = 1, time:16ms rate:1245.38kB/s</span><br><span class="line">&gt; .\hdc_std.exe shell 进入设备shell</span><br><span class="line"># cd /data 进入/data目录</span><br><span class="line"># mkdir test 新建目录便于测试</span><br><span class="line"># chmod +x ./lldb_server</span><br><span class="line"># ./lldb-server platform --listen &quot;*:1234&quot; --server 前提是设备的wifi有连接</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用<code>C:\Users\vv\AppData\Local\OpenHarmony\Sdk\9\native\llvm\bin\lldb.exe</code>或者Ubuntu的lldb连接目标server</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&gt; .\lldb.exe --arch thumbv7</span><br><span class="line">(lldb) platform select remote-linux</span><br><span class="line">  Platform: remote-linux</span><br><span class="line"> Connected: no</span><br><span class="line">(lldb) platform connect connect://192.168.1.8:1234</span><br><span class="line">  Platform: remote-freebsd</span><br><span class="line">    Triple: arm-unknown-linux-unknown</span><br><span class="line">OS Version: 5.10.93 (5.10.93)</span><br><span class="line">  Hostname: localhost</span><br><span class="line"> Connected: yes</span><br><span class="line">WorkingDir: /</span><br><span class="line">    Kernel: #1 SMP Wed Dec 7 15:20:41 CST 2022</span><br><span class="line">(lldb) platform set -w /data/test 设置测试目录为我们刚创建的test目录</span><br><span class="line">(lldb) file ./DiscSdkTest 执行run的时候会将本地文件DiscSdkTest放置到目标目录</span><br><span class="line">(lldb) run 开始运行</span><br></pre></td></tr></table></figure>

<blockquote>
<p>目前32位的系统的lldb存在thumb识别问题, 调试会有很大问题.</p>
</blockquote>
</li>
</ol>
<h1 id="gdbinit-for-aarch64"><a href="#gdbinit-for-aarch64" class="headerlink" title="gdbinit for aarch64"></a>gdbinit for aarch64</h1><p>因为自带的gdb比较简单, 这里我生成一个gdbinit, 方便查看内存和寄存器, 以及单步. </p>
<p>使用时, 在~&#x2F;.gdbinit添加以下内容即可</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br></pre></td><td class="code"><pre><span class="line">set architecture aarch64</span><br><span class="line">set $64BITS=1</span><br><span class="line">set $ARM=1</span><br><span class="line">set $SHOW_CONTEXT=1</span><br><span class="line">define ascii_char</span><br><span class="line">    if $argc != 1</span><br><span class="line">        help ascii_char</span><br><span class="line">    else</span><br><span class="line">        # thanks elaine :)</span><br><span class="line">        set $_c = *(unsigned char *)($arg0)</span><br><span class="line">        if ($_c &lt; 0x20 || $_c &gt; 0x7E)</span><br><span class="line">            printf &quot;.&quot;</span><br><span class="line">        else</span><br><span class="line">            printf &quot;%c&quot;, $_c</span><br><span class="line">        end</span><br><span class="line">    end</span><br><span class="line">end</span><br><span class="line">document ascii_char</span><br><span class="line">Print ASCII value of byte at address ADDR.</span><br><span class="line">Print &quot;.&quot; if the value is unprintable.</span><br><span class="line">Usage: ascii_char ADDR</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">define hex_quad</span><br><span class="line">    if $argc != 1</span><br><span class="line">        help hex_quad</span><br><span class="line">    else</span><br><span class="line">        printf &quot;%02X %02X %02X %02X %02X %02X %02X %02X&quot;, \</span><br><span class="line">               *((unsigned char*)$arg0), *((unsigned char*)$arg0 + 1),     \</span><br><span class="line">               *((unsigned char*)$arg0 + 2), *((unsigned char*)$arg0 + 3), \</span><br><span class="line">               *((unsigned char*)$arg0 + 4), *((unsigned char*)$arg0 + 5), \</span><br><span class="line">               *((unsigned char*)$arg0 + 6), *((unsigned char*)$arg0 + 7)</span><br><span class="line">    end</span><br><span class="line">end</span><br><span class="line">document hex_quad</span><br><span class="line">Print eight hexadecimal bytes starting at address ADDR.</span><br><span class="line">Usage: hex_quad ADDR</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">define hex_dword</span><br><span class="line">    if $argc != 1</span><br><span class="line">        help hex_dword</span><br><span class="line">    else</span><br><span class="line">        printf &quot;0x%08X 0x%08X 0x%08X 0x%08X&quot;, \</span><br><span class="line">               *(unsigned int*)($arg0), *(unsigned int*)((char*)$arg0 + 4),     \</span><br><span class="line">               *(unsigned int*)((char*)$arg0 + 8), *(unsigned int*)((char*)$arg0 + 0xc)</span><br><span class="line">    end</span><br><span class="line">end</span><br><span class="line">document hex_dword</span><br><span class="line">Print eight hexadecimal bytes starting at address ADDR.</span><br><span class="line">Usage: hex_dword ADDR</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">define hex_qword</span><br><span class="line">    if $argc != 1</span><br><span class="line">        help hex_qword</span><br><span class="line">    else</span><br><span class="line">        printf &quot;0x%016llX 0x%016llX&quot;, \</span><br><span class="line">               *(unsigned long long*)($arg0), *(unsigned long long*)((char*)$arg0 + 8)</span><br><span class="line">    end</span><br><span class="line">end</span><br><span class="line">document hex_qword</span><br><span class="line">Print eight hexadecimal bytes starting at address ADDR.</span><br><span class="line">Usage: hex_qword ADDR</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">define hexdump</span><br><span class="line">    if $argc != 1</span><br><span class="line">        help hexdump</span><br><span class="line">    else</span><br><span class="line">        echo \033[1m</span><br><span class="line">        if ($64BITS == 1)</span><br><span class="line">         printf &quot;0x%016lX : &quot;, $arg0</span><br><span class="line">        else</span><br><span class="line">         printf &quot;0x%08X : &quot;, $arg0</span><br><span class="line">        end</span><br><span class="line">        echo \033[0m</span><br><span class="line">        hex_quad $arg0</span><br><span class="line">        echo \033[1m</span><br><span class="line">        printf &quot; - &quot;</span><br><span class="line">        echo \033[0m</span><br><span class="line">        hex_quad $arg0+8</span><br><span class="line">        printf &quot; &quot;</span><br><span class="line">        echo \033[1m</span><br><span class="line">        ascii_char (char*)$arg0+0x0</span><br><span class="line">        ascii_char (char*)$arg0+0x1</span><br><span class="line">        ascii_char (char*)$arg0+0x2</span><br><span class="line">        ascii_char (char*)$arg0+0x3</span><br><span class="line">        ascii_char (char*)$arg0+0x4</span><br><span class="line">        ascii_char (char*)$arg0+0x5</span><br><span class="line">        ascii_char (char*)$arg0+0x6</span><br><span class="line">        ascii_char (char*)$arg0+0x7</span><br><span class="line">        ascii_char (char*)$arg0+0x8</span><br><span class="line">        ascii_char (char*)$arg0+0x9</span><br><span class="line">        ascii_char (char*)$arg0+0xA</span><br><span class="line">        ascii_char (char*)$arg0+0xB</span><br><span class="line">        ascii_char (char*)$arg0+0xC</span><br><span class="line">        ascii_char (char*)$arg0+0xD</span><br><span class="line">        ascii_char (char*)$arg0+0xE</span><br><span class="line">        ascii_char (char*)$arg0+0xF</span><br><span class="line">        echo \033[0m</span><br><span class="line">        printf &quot;\n&quot;</span><br><span class="line">    end</span><br><span class="line">end</span><br><span class="line">document hexdump</span><br><span class="line">Display a 16-byte hex/ASCII dump of memory at address ADDR.</span><br><span class="line">Usage: hexdump ADDR</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">define hexDwordDump</span><br><span class="line">    if $argc != 1</span><br><span class="line">        help hexDwordDump</span><br><span class="line">    else</span><br><span class="line">        echo \033[1m</span><br><span class="line">        if ($64BITS == 1)</span><br><span class="line">         printf &quot;0x%016lX : &quot;, $arg0</span><br><span class="line">        else</span><br><span class="line">         printf &quot;0x%08X : &quot;, $arg0</span><br><span class="line">        end</span><br><span class="line">        echo \033[0m</span><br><span class="line">        hex_dword $arg0</span><br><span class="line">        printf &quot; &quot;</span><br><span class="line">        echo \033[1m</span><br><span class="line">        ascii_char (char*)$arg0+0x0</span><br><span class="line">        ascii_char (char*)$arg0+0x1</span><br><span class="line">        ascii_char (char*)$arg0+0x2</span><br><span class="line">        ascii_char (char*)$arg0+0x3</span><br><span class="line">        ascii_char (char*)$arg0+0x4</span><br><span class="line">        ascii_char (char*)$arg0+0x5</span><br><span class="line">        ascii_char (char*)$arg0+0x6</span><br><span class="line">        ascii_char (char*)$arg0+0x7</span><br><span class="line">        ascii_char (char*)$arg0+0x8</span><br><span class="line">        ascii_char (char*)$arg0+0x9</span><br><span class="line">        ascii_char (char*)$arg0+0xA</span><br><span class="line">        ascii_char (char*)$arg0+0xB</span><br><span class="line">        ascii_char (char*)$arg0+0xC</span><br><span class="line">        ascii_char (char*)$arg0+0xD</span><br><span class="line">        ascii_char (char*)$arg0+0xE</span><br><span class="line">        ascii_char (char*)$arg0+0xF</span><br><span class="line">        echo \033[0m</span><br><span class="line">        printf &quot;\n&quot;</span><br><span class="line">    end</span><br><span class="line">end</span><br><span class="line">document hexDwordDump</span><br><span class="line">Display a 16-byte hex/ASCII dump of memory at address ADDR.</span><br><span class="line">Usage: hexDwordDump ADDR</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">define hexQwordDump</span><br><span class="line">    if $argc != 1</span><br><span class="line">        help hexQwordDump</span><br><span class="line">    else</span><br><span class="line">        echo \033[1m</span><br><span class="line">        if ($64BITS == 1)</span><br><span class="line">         printf &quot;0x%016lX : &quot;, $arg0</span><br><span class="line">        else</span><br><span class="line">         printf &quot;0x%08X : &quot;, $arg0</span><br><span class="line">        end</span><br><span class="line">        echo \033[0m</span><br><span class="line">        hex_qword $arg0</span><br><span class="line">        printf &quot; &quot;</span><br><span class="line">        echo \033[1m</span><br><span class="line">        ascii_char (char*)$arg0+0x0</span><br><span class="line">        ascii_char (char*)$arg0+0x1</span><br><span class="line">        ascii_char (char*)$arg0+0x2</span><br><span class="line">        ascii_char (char*)$arg0+0x3</span><br><span class="line">        ascii_char (char*)$arg0+0x4</span><br><span class="line">        ascii_char (char*)$arg0+0x5</span><br><span class="line">        ascii_char (char*)$arg0+0x6</span><br><span class="line">        ascii_char (char*)$arg0+0x7</span><br><span class="line">        ascii_char (char*)$arg0+0x8</span><br><span class="line">        ascii_char (char*)$arg0+0x9</span><br><span class="line">        ascii_char (char*)$arg0+0xA</span><br><span class="line">        ascii_char (char*)$arg0+0xB</span><br><span class="line">        ascii_char (char*)$arg0+0xC</span><br><span class="line">        ascii_char (char*)$arg0+0xD</span><br><span class="line">        ascii_char (char*)$arg0+0xE</span><br><span class="line">        ascii_char (char*)$arg0+0xF</span><br><span class="line">        echo \033[0m</span><br><span class="line">        printf &quot;\n&quot;</span><br><span class="line">    end</span><br><span class="line">end</span><br><span class="line">document hexQwordDump</span><br><span class="line">Display a 16-byte hex/ASCII dump of memory at address ADDR.</span><br><span class="line">Usage: hexQwordDump ADDR</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># _______________data window__________________</span><br><span class="line">define ddump</span><br><span class="line">    if $argc != 2</span><br><span class="line">        help ddump</span><br><span class="line">    else</span><br><span class="line">        echo \033[34m</span><br><span class="line">        if $ARM == 1</span><br><span class="line">            printf &quot;[0x%08X]&quot;, $data_addr</span><br><span class="line">        else</span><br><span class="line">            if ($64BITS == 1)</span><br><span class="line">             printf &quot;[0x%04X:0x%016lX]&quot;, $ds, $data_addr</span><br><span class="line">            else</span><br><span class="line">             printf &quot;[0x%04X:0x%08X]&quot;, $ds, $data_addr</span><br><span class="line">            end</span><br><span class="line">        end</span><br><span class="line">    echo \033[34m</span><br><span class="line">    printf &quot;------------------------&quot;</span><br><span class="line">    printf &quot;-------------------------------&quot;</span><br><span class="line">    if ($64BITS == 1)</span><br><span class="line">     printf &quot;-------------------------------------&quot;</span><br><span class="line">    end</span><br><span class="line"></span><br><span class="line">    echo \033[1;34m</span><br><span class="line">    printf &quot;[data]\n&quot;</span><br><span class="line">        echo \033[0m</span><br><span class="line">        set $_count = 0</span><br><span class="line">        while ($_count &lt; $arg1)</span><br><span class="line">            set $_i = ($_count * 0x10)</span><br><span class="line">            if $arg0 == 1</span><br><span class="line">                hexdump $data_addr+$_i</span><br><span class="line">            end</span><br><span class="line">            if $arg0 == 2</span><br><span class="line">                hexDwordDump $data_addr+$_i</span><br><span class="line">            end</span><br><span class="line">            if $arg0 == 3</span><br><span class="line">                hexQwordDump $data_addr+$_i</span><br><span class="line">            end</span><br><span class="line">            set $_count++</span><br><span class="line">        end</span><br><span class="line">    end</span><br><span class="line">end</span><br><span class="line">document ddump</span><br><span class="line">Display NUM lines of hexdump for address in $data_addr global variable.</span><br><span class="line">Usage: ddump TYPE NUM</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">define db</span><br><span class="line">    if($argc != 1 &amp;&amp; $argc != 2)</span><br><span class="line">        help db</span><br><span class="line">    else</span><br><span class="line">        set $data_addr = (char*)$arg0</span><br><span class="line">        if($argc == 1)</span><br><span class="line">            ddump 1 5</span><br><span class="line">        else</span><br><span class="line">            ddump 1 $arg1</span><br><span class="line">        end</span><br><span class="line">    end</span><br><span class="line">end</span><br><span class="line">document db</span><br><span class="line">Display 16 lines of a hex dump of address starting at ADDR.</span><br><span class="line">Usage: db ADDR LINE</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">define dd</span><br><span class="line">    if($argc != 1 &amp;&amp; $argc != 2)</span><br><span class="line">        help dd</span><br><span class="line">    else</span><br><span class="line">        set $data_addr = (char*)$arg0</span><br><span class="line">        if($argc == 1)</span><br><span class="line">            ddump 2 5</span><br><span class="line">        else</span><br><span class="line">            ddump 2 $arg1</span><br><span class="line">        end</span><br><span class="line">    end</span><br><span class="line">end</span><br><span class="line">document dd</span><br><span class="line">Display 16 lines of a hex dump of address starting at ADDR.</span><br><span class="line">Usage: dd ADDR LINE</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">define dq</span><br><span class="line">    if($argc != 1 &amp;&amp; $argc != 2)</span><br><span class="line">        help dq</span><br><span class="line">    else</span><br><span class="line">        set $data_addr = (char*)$arg0</span><br><span class="line">        if($argc == 1)</span><br><span class="line">            ddump 3 8</span><br><span class="line">        else</span><br><span class="line">            ddump 3 $arg1</span><br><span class="line">        end</span><br><span class="line">    end</span><br><span class="line">end</span><br><span class="line">document dq</span><br><span class="line">Display 16 lines of a hex dump of address starting at ADDR.</span><br><span class="line">Usage: dq ADDR LINE</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">define reg</span><br><span class="line">    printf &quot;  &quot;</span><br><span class="line">    echo \033[32m</span><br><span class="line">    printf &quot;$x0:&quot;</span><br><span class="line">    echo \033[0m</span><br><span class="line">    printf &quot; 0x%016lX  &quot;, $x0</span><br><span class="line">    echo \033[32m</span><br><span class="line">    printf &quot;$x1:&quot;</span><br><span class="line">    echo \033[0m</span><br><span class="line">    printf &quot; 0x%016lX  &quot;, $x1</span><br><span class="line">    echo \033[32m</span><br><span class="line">    printf &quot;$x2:&quot;</span><br><span class="line">    echo \033[0m</span><br><span class="line">    printf &quot; 0x%016lX  &quot;, $x2</span><br><span class="line">    echo \033[32m</span><br><span class="line">    printf &quot;$x3:&quot;</span><br><span class="line">    echo \033[0m</span><br><span class="line">    printf &quot; 0x%016lX  &quot;, $x3</span><br><span class="line">    echo \033[32m</span><br><span class="line">    echo \n</span><br><span class="line">    printf &quot;$x4:&quot;</span><br><span class="line">    echo \033[0m</span><br><span class="line">    printf &quot; 0x%016lX  &quot;, $x4</span><br><span class="line">    echo \033[32m</span><br><span class="line">    printf &quot;$x5:&quot;</span><br><span class="line">    echo \033[0m</span><br><span class="line">    printf &quot; 0x%016lX  &quot;, $x5</span><br><span class="line">    echo \033[32m</span><br><span class="line">    printf &quot;$x6:&quot;</span><br><span class="line">    echo \033[0m</span><br><span class="line">    printf &quot; 0x%016lX  &quot;, $x6</span><br><span class="line">    echo \033[32m</span><br><span class="line">    printf &quot;$x7:&quot;</span><br><span class="line">    echo \033[0m</span><br><span class="line">    printf &quot; 0x%016lX  &quot;, $x7</span><br><span class="line">    echo \033[32m</span><br><span class="line">    echo \n</span><br><span class="line">    printf &quot;$x8:&quot;</span><br><span class="line">    echo \033[0m</span><br><span class="line">    printf &quot; 0x%016lX  &quot;, $x8</span><br><span class="line">    echo \033[32m</span><br><span class="line">    printf &quot;$x9:&quot;</span><br><span class="line">    echo \033[0m</span><br><span class="line">    printf &quot; 0x%016lX  &quot;, $x9</span><br><span class="line">    echo \033[32m</span><br><span class="line">    printf &quot;$x10:&quot;</span><br><span class="line">    echo \033[0m</span><br><span class="line">    printf &quot; 0x%016lX  &quot;, $x10</span><br><span class="line">    echo \033[32m</span><br><span class="line">    printf &quot;$x11:&quot;</span><br><span class="line">    echo \033[0m</span><br><span class="line">    printf &quot; 0x%016lX  &quot;, $x11</span><br><span class="line">    echo \033[32m</span><br><span class="line">    echo \n</span><br><span class="line">    printf &quot;$x12:&quot;</span><br><span class="line">    echo \033[0m</span><br><span class="line">    printf &quot; 0x%016lX  &quot;, $x12</span><br><span class="line">    echo \033[32m</span><br><span class="line">    printf &quot;$x13:&quot;</span><br><span class="line">    echo \033[0m</span><br><span class="line">    printf &quot; 0x%016lX  &quot;, $x13</span><br><span class="line">    echo \033[32m</span><br><span class="line">    printf &quot;$x14:&quot;</span><br><span class="line">    echo \033[0m</span><br><span class="line">    printf &quot; 0x%016lX  &quot;, $x14</span><br><span class="line">    echo \033[32m</span><br><span class="line">    printf &quot;$x15:&quot;</span><br><span class="line">    echo \033[0m</span><br><span class="line">    printf &quot; 0x%016lX  &quot;, $x15</span><br><span class="line">    echo \033[32m</span><br><span class="line">    echo \n</span><br><span class="line">    printf &quot;$x16:&quot;</span><br><span class="line">    echo \033[0m</span><br><span class="line">    printf &quot; 0x%016lX  &quot;, $x16</span><br><span class="line">    echo \033[32m</span><br><span class="line">    printf &quot;$x17:&quot;</span><br><span class="line">    echo \033[0m</span><br><span class="line">    printf &quot; 0x%016lX  &quot;, $x17</span><br><span class="line">    echo \033[32m</span><br><span class="line">    printf &quot;$x18:&quot;</span><br><span class="line">    echo \033[0m</span><br><span class="line">    printf &quot; 0x%016lX  &quot;, $x18</span><br><span class="line">    echo \033[32m</span><br><span class="line">    printf &quot;$x19:&quot;</span><br><span class="line">    echo \033[0m</span><br><span class="line">    printf &quot; 0x%016lX  &quot;, $x19</span><br><span class="line">    echo \033[32m</span><br><span class="line">    echo \n</span><br><span class="line">    printf &quot;$x20:&quot;</span><br><span class="line">    echo \033[0m</span><br><span class="line">    printf &quot; 0x%016lX  &quot;, $x20</span><br><span class="line">    echo \033[32m</span><br><span class="line">    printf &quot;$x21:&quot;</span><br><span class="line">    echo \033[0m</span><br><span class="line">    printf &quot; 0x%016lX  &quot;, $x21</span><br><span class="line">    echo \033[32m</span><br><span class="line">    printf &quot;$x22:&quot;</span><br><span class="line">    echo \033[0m</span><br><span class="line">    printf &quot; 0x%016lX  &quot;, $x22</span><br><span class="line">    echo \033[32m</span><br><span class="line">    printf &quot;$x23:&quot;</span><br><span class="line">    echo \033[0m</span><br><span class="line">    printf &quot; 0x%016lX  &quot;, $x23</span><br><span class="line">    echo \033[32m</span><br><span class="line">    echo \n</span><br><span class="line">    printf &quot;$x24:&quot;</span><br><span class="line">    echo \033[0m</span><br><span class="line">    printf &quot; 0x%016lX  &quot;, $x24</span><br><span class="line">    echo \033[32m</span><br><span class="line">    printf &quot;$x25:&quot;</span><br><span class="line">    echo \033[0m</span><br><span class="line">    printf &quot; 0x%016lX  &quot;, $x25</span><br><span class="line">    echo \033[32m</span><br><span class="line">    printf &quot;$x26:&quot;</span><br><span class="line">    echo \033[0m</span><br><span class="line">    printf &quot; 0x%016lX  &quot;, $x26</span><br><span class="line">    echo \033[32m</span><br><span class="line">    printf &quot;$x27:&quot;</span><br><span class="line">    echo \033[0m</span><br><span class="line">    printf &quot; 0x%016lX  &quot;, $x27</span><br><span class="line">    echo \033[32m</span><br><span class="line">    echo \n</span><br><span class="line">    printf &quot;$x28:&quot;</span><br><span class="line">    echo \033[0m</span><br><span class="line">    printf &quot; 0x%016lX  &quot;, $x28</span><br><span class="line">    echo \033[32m</span><br><span class="line">    printf &quot;$x29:&quot;</span><br><span class="line">    echo \033[0m</span><br><span class="line">    printf &quot; 0x%016lX  &quot;, $x29</span><br><span class="line">    echo \033[32m</span><br><span class="line">    printf &quot;$x30:&quot;</span><br><span class="line">    echo \033[0m</span><br><span class="line">    printf &quot; 0x%016lX  &quot;, $x30</span><br><span class="line">    echo \033[32m</span><br><span class="line">    echo \n</span><br><span class="line">    printf &quot;$sp:&quot;</span><br><span class="line">    echo \033[0m</span><br><span class="line">    printf &quot; 0x%016lX  &quot;, $sp</span><br><span class="line">    echo \033[32m</span><br><span class="line">    printf &quot;$pc:&quot;</span><br><span class="line">    echo \033[0m</span><br><span class="line">    printf &quot; 0x%016lX  &quot;, $pc</span><br><span class="line">    echo \033[0m</span><br><span class="line">    echo \n</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">define context</span><br><span class="line">reg</span><br><span class="line">x/8i $pc</span><br><span class="line">dq $sp 3</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">define hook-stop</span><br><span class="line">    # this makes &#x27;context&#x27; be called at every BP/step</span><br><span class="line">    if ($SHOW_CONTEXT &gt; 0)</span><br><span class="line">        context</span><br><span class="line">    end</span><br><span class="line">end</span><br><span class="line">document hook-stop</span><br><span class="line">!!! FOR INTERNAL USE ONLY - DO NOT CALL !!!</span><br><span class="line">end</span><br></pre></td></tr></table></figure>

</div></article></div></main><footer><div class="paginator"><a href="/2023/02/22/qemu-build/" class="prev">上一篇</a><a href="/2023/02/22/bug-skills/" class="next">下一篇</a></div><div id="container"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css"><script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script><div id="gitalk-container"></div><script>const gitalk = new Gitalk({
    clientID: '28b1a73c3ed656a9a85d',     
    clientSecret: '59837bb4cbe7b2f12df366fdbcb37fa4ba084d44',     
    id: 'Wed Feb 22 2023 19:54:44 GMT+0800',    
    repo: 'blog-comment',     
    owner: '474172261',     
    admin: '474172261',     
})   
gitalk.render('gitalk-container')</script><div class="copyright"><p>© 2015 - 2025 <a href="http://474172261.github.io">VictorV</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>